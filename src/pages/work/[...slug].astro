---
import { getCollection } from "astro:content";
import type { AstroSeoProps } from "@astrolib/seo";
import MarkdownPostLayout from "../../layouts/MarkdownPostLayout.astro";

export async function getStaticPaths() {
	const projectsEntries = await getCollection("projects");

	return projectsEntries
		.map((entry) => {
			const [lang, ...slug] = entry.slug.split("/");
			return { params: { lang, slug: slug.join("/") || undefined }, props: entry };
		})
		.filter((entry) => entry.params.lang === "en");
}

const entry = Astro.props;
const { Content } = await entry.render();

const ogImageUrl = new URL(entry.data.image.source.src, Astro.site).toString();

const seo: AstroSeoProps = {
	title: `${entry.data.title} - Metarrelato`,
	description: entry.data.description,
	canonical: `https://mintaka.co/work/${entry.slug}/`,
	openGraph: {
		type: "article",
		url: `https://mintaka.co/work/${entry.slug}/`,
		title: entry.data.title,
		description: entry.data.description,
		images: [
			{
				url: ogImageUrl,
				width: 1600,
				height: 1067,
				alt: entry.data.image.alt,
				type: "image/jpeg",
			},
		],
		site_name: "Metarrelato",
	},
	twitter: {
		handle: "@metarrelato",
		site: "@metarrelato",
		cardType: "summary_large_image",
	},
};
---

<MarkdownPostLayout frontmatter={entry.data} body={entry.body} seo={seo}>
	<Content />
</MarkdownPostLayout>
