---
import BaseLayout from "@/layouts/BaseLayout.astro";
import type { AstroSeoProps } from "@astrolib/seo";
import Articles from "@components/blog/Articles.astro";
import { getCollection } from "astro:content";
import { getLangFromUrl } from "@i18n/utils";

export async function getStaticPaths({ paginate }) {
    const lang = "en"; // Or dynamically get if supporting multiple langs in one file, but usually files are separate or logic is here
    // Since getLangFromUrl needs Astro.url which isn't available in getStaticPaths, we'll assume 'en' for this file structure 
    // OR we need to fetch all and filter. Based on Articles.astro, it filters by lang.
    // Let's replicate the logic: fetch all, filter by 'en' (or current locale), sort, then paginate.
    
    // However, looking at Articles.astro, it was doing the fetching inside itself. 
    // To paginate, we MUST do fetching in getStaticPaths.
    
    // We'll fetch all 'en' posts here.
    const allPosts = (await getCollection("posts"))
        .filter((post) => {
            const [postLang, ...slug] = post.slug.split("/");
            return postLang === "en"; // Hardcoded 'en' for this route /blog/[...page] which is usually default.
        })
        .map((post) => {
            const [postLang, slug] = post.slug.split("/");
            return {
                ...post,
                slug: slug,
            };
        })
        .sort((a, b) => Number(b.data.pubDate) - Number(a.data.pubDate));

    return paginate(allPosts, { pageSize: 10 });
}

const { page } = Astro.props;

const seo: AstroSeoProps = {
	title: "Metarrelato Blog: Análisis de Inteligencia Artificial y su impacto en la sociedad",
	description:
		"Explore the Metarrelato Blog for the latest trends, tips, and insights in web design, web dev and SEO. Stay updated with our innovative digital solutions.",
	canonical: "https://metarrelato.com/blog/",
	openGraph: {
		url: "https://metarrelato.com/blog",
		title: "Metarrelato Blog: Análisis de Inteligencia Artificial y su impacto en la sociedad",
		description:
			"Stay informed with the latest in web design and SEO on the Metarrelato Blog. Expert advice, tips, and industry insights await you.",
		images: [
			{
				url: "/images/meta/mintaka_share.gif",
				width: 1200,
				height: 630,
				alt: "Social open graph image of Metarrelato Blog",
				type: "image/gif",
			},
			{
				url: "/images/meta/mintaka_share.gif",
				width: 4096,
				height: 4096,
				alt: "Twitter open graph image of Metarrelato Blog",
				type: "image/gif",
			},
		],
		site_name: "Metarrelato",
	},
	twitter: {
		handle: "@metarrelato",
		site: "@metarrelato",
		cardType: "summary_large_image",
	},
};
---

<BaseLayout seo={seo}>
	<Articles page={page} />
</BaseLayout>
