---
import Title from "@components/global/Title.astro";

import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);
---

<section class="isolate px-6 py-24 sm:py-32 lg:px-8">
	<div class="absolute inset-x-0 top-[-10rem] transform-gpu overflow-hidden blur-3xl sm:top-[-20rem]" aria-hidden="true">
		<div class="gradient-element"></div>
	</div>
	<div class="mx-auto">
		<Title class="pb-10 pt-20 uppercase" title={t("contact.title")} subtitle={t("contact.subtitle")} />
		
		<!-- Chatbot Interface -->
		<div class="mx-auto max-w-2xl pt-12 lg:pt-20">
			<div class="bg-white/50 backdrop-blur-sm rounded-2xl shadow-xl overflow-hidden border border-white/20">
				<!-- Chat History -->
				<div id="chat-history" class="h-[400px] overflow-y-auto p-6 space-y-4 bg-slate-50/50">
					<div class="flex flex-col gap-2">
						<div class="self-start bg-slate-200 rounded-lg rounded-tl-none px-4 py-2 max-w-[80%] text-slate-800">
							{lang === 'en' 
								? "Hola, soy el asistente de IA de Metarrelato. Puedo ayudarte a agendar una cita o enviar un correo. ¿En qué puedo ayudarte hoy?" 
								: "Hello, I am Metarrelato's AI assistant. I can help you schedule an appointment or send an email. How can I help you today?"}
						</div>
					</div>
				</div>

				<!-- Input Area -->
				<div class="p-4 bg-white border-t border-slate-100">
					<div class="flex gap-4">
						<input 
							type="text" 
							id="chat-input"
							class="flex-1 bg-slate-100 border-0 rounded-xl px-4 py-3 text-slate-800 focus:ring-2 focus:ring-purple-500 outline-none transition-all placeholder:text-slate-400"
							placeholder={t("contact.message")}
						/>
						<button 
							id="send-button"
							class="bg-[#F06071] text-white p-3 rounded-xl hover:bg-[#F06071]/80 transition-colors flex items-center justify-center aspect-square shadow-lg hover:shadow-xl transform hover:scale-105"
							aria-label={t("contact.send")}
						>
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
								<path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
							</svg>
						</button>
					</div>
					<div class="text-center mt-3">
						 <p class="text-xs text-slate-400">
							{t("contact.agree")} <a href="/privacy" class="font-semibold text-slate-600 hover:text-purple-600 transition-colors">privacy policy</a>.
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<script>
	const chatInput = document.getElementById('chat-input') as HTMLInputElement;
	const sendButton = document.getElementById('send-button');
	const chatHistory = document.getElementById('chat-history');

	function addMessage(text: string, isUser: boolean) {
		if (!chatHistory) return;
		
		const wrapper = document.createElement('div');
		wrapper.className = `flex flex-col gap-2 ${isUser ? 'items-end' : ''}`;
		
		const message = document.createElement('div');
		message.className = `px-4 py-2 max-w-[80%] rounded-lg ${isUser ? 'bg-zinc-900 text-white rounded-tr-none shadow-md' : 'self-start bg-slate-200 text-slate-800 rounded-tl-none shadow-sm'}`;
		message.textContent = text;
		
		wrapper.appendChild(message);
		chatHistory.appendChild(wrapper);
		chatHistory.scrollTop = chatHistory.scrollHeight;
	}

	function handleSend() {
		if (!chatInput || !chatInput.value.trim()) return;
		
		const text = chatInput.value;
		addMessage(text, true);
		chatInput.value = '';
	}

	sendButton?.addEventListener('click', handleSend);
	chatInput?.addEventListener('keypress', (e) => {
		if (e.key === 'Enter') handleSend();
	});
</script>

<style>
	.gradient-element {
		@apply relative left-1/2 -z-10 aspect-[1155/678] w-[36.125rem] max-w-none -translate-x-1/2 rotate-[30deg] bg-gradient-to-tr from-[#ff80b5] to-[#9089fc] opacity-30 sm:left-[calc(50%-40rem)] sm:w-[72.1875rem];
		clip-path: polygon(
			74.1% 44.1%,
			100% 61.6%,
			97.5% 26.9%,
			85.5% 0.1%,
			80.7% 2%,
			72.5% 32.5%,
			60.2% 62.4%,
			52.4% 68.1%,
			47.5% 58.3%,
			45.2% 34.5%,
			27.5% 76.7%,
			0.1% 64.9%,
			17.9% 100%,
			27.6% 76.8%,
			76.1% 97.7%,
			74.1% 44.1%
		);
	}
</style>
