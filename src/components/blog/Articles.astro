---
import { getCollection } from "astro:content";
import Entry from "@/components/blog/Entry.astro";
import Title from "@components/global/Title.astro";
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const { page } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

let postsToDisplay = [];

if (page) {
	postsToDisplay = page.data;
} else {
	// Fallback if page prop is not provided (though it should be for pagination)
	postsToDisplay = (await getCollection("posts"))
		.filter((post) => {
			const [postLang, ...slug] = post.slug.split("/");
			return postLang === lang;
		})
		.map((post) => {
			const [postLang, slug] = post.slug.split("/");

			return {
				...post,
				slug: slug,
			};
		})
		.sort((a, b) => Number(b.data.pubDate) - Number(a.data.pubDate));
}
---

<section>

	<div class="mx-auto flex flex-col gap-16 px-8 py-24 md:px-12 lg:pt-32 2xl:max-w-7xl">
		<!-- svg: first layer -->
		<svg class="hidden" viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg">
			<filter id="article-noise-filter">
				<feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"></feTurbulence>
			</filter>
		</svg>
		<Title title={t("blog.title")} subtitle={t("blog.subtitle")} class="pb-10 pt-20 uppercase" />
		{
			postsToDisplay && postsToDisplay[0] && (
				<Entry
					url={"/blog/" + postsToDisplay[0].slug}
					title={postsToDisplay[0].data.title}
					description={postsToDisplay[0].data.description}
					alt={postsToDisplay[0].data.title}
					pubDate={postsToDisplay[0].data.pubDate.toString().slice(0, 10)}
					author={postsToDisplay[0].data.author}
					image={postsToDisplay[0].data.image.source}
					titleInside={false}
				/>
			)
		}

		<div class="grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3">
			{
				postsToDisplay
					.slice(1)
					.map((post) => (
						<Entry
							url={"/blog/" + post.slug}
							title={post.data.title}
							description={post.data.description}
							alt={post.data.title}
							pubDate={post.data.pubDate.toString().slice(0, 10)}
							author={post.data.author}
							image={post.data.image.source}
						/>
					))
			}
		</div>
		
		{
			page && (page.url.prev || page.url.next) && (
				<div class="flex justify-center gap-4 mt-8">
					{page.url.prev ? (
						<a href={page.url.prev} class="px-4 py-2 bg-[#F06071] text-white rounded hover:bg-[#d65565] transition-colors w-32 text-center inline-block">
							&larr; Anterior
						</a>
					) : null}
					{page.url.next ? (
						<a href={page.url.next} class="px-4 py-2 bg-[#F06071] text-white rounded hover:bg-[#d65565] transition-colors w-32 text-center inline-block">
							Siguiente &rarr;
						</a>
					) : null}
				</div>
			)
		}
	</div>
</section>

<style>

	.article-overlay {
		background-repeat: no-repeat;
		background-position: center;
		background-size: cover;
	}
</style>
