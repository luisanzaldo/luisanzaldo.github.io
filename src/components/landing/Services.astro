---
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";
import { Image } from "astro:assets";
import websiteImage from "../../assets/images/services/website-ia.png";
import appImage from "../../assets/images/services/servidor-ia.png";
import uiuxImage from "../../assets/images/services/cerebro-ia.png";
import seoImage from "../../assets/images/services/reportes-ia.png";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const { class: className } = Astro.props;

const points = [
	{
		title: t("websites.title"),
		content: t("websites.content"),
		image: websiteImage,
	},
	{
		title: t("apps.title"),
		content: t("apps.content"),
		image: appImage,
	},
	{
		title: t("uiux.title"),
		content: t("uiux.content"),
		image: uiuxImage,
	},
	{
		title: t("seo.title"),
		content: t("seo.content"),
		image: seoImage,
	},
];
---

<section id="services" class:list={["section home-dark-section services-section", className]}>
	<div class="col-span-12 flex flex-col gap-32 py-20 lg:pt-4">
		<h2 class="sr-only">{t("services")}</h2>
		{
			points.map(({ title, content, image }, index) => (
				<div class={`service-item flex w-full flex-col-reverse items-center justify-center gap-12 md:gap-20 lg:gap-40 ${index % 2 === 1 ? 'md:flex-row-reverse' : 'md:flex-row'}`}>
					<div class="w-full max-w-md lg:max-w-lg">
						<div class="visual-element w-full h-auto aspect-square flex items-center justify-center">
							<Image 
								src={image} 
								alt={title} 
								class={`w-full h-full object-contain ${index === 3 ? 'scale-[0.81] lg:scale-90' : ''} ${index === 0 ? 'scale-x-[-1]' : ''}`}
								widths={[300, 600, 900]}
								sizes="(max-width: 768px) 100vw, 500px"
								format="avif"
								quality={80}
							/>
						</div>
					</div>
					<article class="flex flex-col gap-6 text-center md:text-left">
						<h3 class="font-display text-4xl uppercase md:text-5xl lg:text-6xl text-balance text-[#d4eb28]" set:html={title} />
						<p class="max-w-xl text-lg text-balance" set:html={content} />
					</article>
				</div>
			))
		}
	</div>
</section>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";

	gsap.registerPlugin(ScrollTrigger);

	function init() {
		const services = document.querySelectorAll(".service-item");
		const isMobile = window.matchMedia("(max-width: 768px)").matches;

		services.forEach((service) => {
			const visual = service.querySelector(".visual-element");
			const content = service.querySelector("article");

			// Add GPU acceleration hints
			if (visual instanceof HTMLElement) {
				visual.style.willChange = "transform, opacity";
				visual.style.transform = "translateZ(0)";
			}
			if (content instanceof HTMLElement) {
				content.style.willChange = "transform, opacity";
				content.style.transform = "translateZ(0)";
			}

			// Illustration Animation — lighter on mobile
			gsap.from(visual, {
				scrollTrigger: {
					trigger: service,
					start: isMobile ? "top 80%" : "top 65%",
					toggleActions: isMobile ? "play none none none" : "play none none reverse",
				},
				scale: isMobile ? 1 : 0.3,
				y: isMobile ? 30 : 60,
				autoAlpha: 0,
				duration: isMobile ? 0.6 : 1.5,
				ease: isMobile ? "power2.out" : "back.out(2)",
			});

			// Text Content Animation — lighter on mobile
			gsap.from(content, {
				scrollTrigger: {
					trigger: service,
					start: isMobile ? "top 75%" : "top 60%",
					toggleActions: isMobile ? "play none none none" : "play none none reverse",
				},
				y: isMobile ? 30 : 100,
				autoAlpha: 0,
				duration: isMobile ? 0.5 : 1.2,
				ease: isMobile ? "power2.out" : "power4.out",
			});
		});
	}

	document.removeEventListener("DOMContentLoaded", init);
	document.addEventListener("DOMContentLoaded", init);
</script>
